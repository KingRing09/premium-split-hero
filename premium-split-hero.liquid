{% comment %}
  ╔══════════════════════════════════════════════════════════════╗
  ║  PREMIUM SPLIT HERO SECTION v2.1                             ║
  ║  © 2024 - All Rights Reserved                                ║
  ║                                                              ║
  ║  Features:                                                   ║
  ║  - 2, 3, or 4 column layouts (Desktop)                       ║
  ║  - Grayscale to color hover effect                           ║
  ║  - Mobile expandable cards with notification dots            ║
  ║  - Full Shopify Theme Editor customization                   ║
  ║  - Accessibility ready (ARIA, keyboard navigation)           ║
  ║  - Performance optimized (lazy loading, fetchpriority)       ║
  ║                                                              ║
  ║  Compatible with: Dawn, Debut, Prestige, Impulse, Turbo      ║
  ║  and all Shopify OS 2.0 Themes                               ║
  ╚══════════════════════════════════════════════════════════════╝
{% endcomment %}

{% schema %}
{
  "name": "Premium Split Hero",
  "tag": "section",
  "class": "split-hero-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "column_count",
      "label": "Number of Columns (Desktop)",
      "options": [
        { "value": "2", "label": "2 Columns" },
        { "value": "3", "label": "3 Columns" },
        { "value": "4", "label": "4 Columns" }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "section_height",
      "label": "Section Height (vh)",
      "min": 50,
      "max": 100,
      "step": 5,
      "default": 100,
      "unit": "vh"
    },
    {
      "type": "header",
      "content": "Center Content"
    },
    {
      "type": "image_picker",
      "id": "center_logo",
      "label": "Center Logo (Desktop)"
    },
    {
      "type": "text",
      "id": "center_brand_text",
      "label": "Brand Text (if no logo)",
      "default": "YOUR BRAND"
    },
    {
      "type": "text",
      "id": "center_heading",
      "label": "Center Heading",
      "default": "Choose Your Style"
    },
    {
      "type": "text",
      "id": "seo_heading",
      "label": "SEO H1 Heading (Hidden)",
      "default": "Discover Our Premium Collections"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "text",
      "id": "mobile_welcome",
      "label": "Mobile Welcome Text",
      "default": "Welcome to Our Store"
    },
    {
      "type": "text",
      "id": "mobile_heading",
      "label": "Mobile Heading",
      "default": "Choose Your Style"
    },
    {
      "type": "range",
      "id": "card_collapsed_height",
      "label": "Card Collapsed Height",
      "min": 150,
      "max": 300,
      "step": 10,
      "default": 200,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "card_expanded_height",
      "label": "Card Expanded Height",
      "min": 300,
      "max": 500,
      "step": 10,
      "default": 380,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#6366F1"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#0a0a0b"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "notification_dot_color",
      "label": "Notification Dot Color",
      "default": "#ef4444"
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "limit": 4,
      "settings": [
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Collection"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "Discover amazing products"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text (Mobile)",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Image Alt Text",
          "default": "Collection image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Premium Split Hero",
      "blocks": [
        {
          "type": "column",
          "settings": {
            "title": "Women",
            "subtitle": "Elegant styles for the modern woman",
            "button_text": "Shop Women"
          }
        },
        {
          "type": "column",
          "settings": {
            "title": "Men",
            "subtitle": "Contemporary fashion for him",
            "button_text": "Shop Men"
          }
        }
      ]
    }
  ]
}
{% endschema %}

{% style %}
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap');

  #shopify-section-{{ section.id }} {
    --hero-accent: {{ section.settings.accent_color }};
    --hero-bg: {{ section.settings.background_color }};
    --hero-text: {{ section.settings.text_color }};
    --hero-dot: {{ section.settings.notification_dot_color }};
    --hero-font-heading: 'Poppins', sans-serif;
    --hero-font-body: 'Inter', sans-serif;
    --hero-height: {{ section.settings.section_height }}vh;
    --hero-card-collapsed: {{ section.settings.card_collapsed_height }}px;
    --hero-card-expanded: {{ section.settings.card_expanded_height }}px;
  }

  .hero-split-section {
    position: relative;
    z-index: 1;
    width: 100%;
    height: var(--hero-height);
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--hero-bg);
    color: var(--hero-text);
    font-family: var(--hero-font-body);
  }

  .hero-sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Desktop Container */
  .hero-desktop-container {
    width: 100%;
    height: 100%;
    display: flex;
    position: relative;
    justify-content: center;
    align-items: center;
  }

  .hero-split-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
  }

  .hero-split-wrapper.cols-2 .hero-column { width: 50%; }
  .hero-split-wrapper.cols-3 .hero-column { width: 33.333%; }
  .hero-split-wrapper.cols-4 .hero-column { width: 25%; }

  .hero-column {
    position: relative;
    height: 100%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1);
    box-shadow: inset 0 -40px 60px rgba(0, 0, 0, 0.6);
    perspective: 1000px;
  }

  .hero-column:hover {
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.4), inset 0 -60px 100px rgba(0, 0, 0, 0.5);
    z-index: 10;
  }

  .hero-column-img {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
    filter: grayscale(100%) brightness(65%);
    transition: filter 0.8s cubic-bezier(0.25, 1, 0.5, 1), transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
    will-change: filter, transform;
    transform: scale(1.05);
  }

  .hero-column:hover .hero-column-img {
    filter: grayscale(0%) brightness(100%);
    transform: scale(1.1) translateY(-8px);
  }

  .hero-column-link {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
  }

  .hero-column-link:focus {
    outline: 3px solid var(--hero-accent);
    outline-offset: -3px;
  }

  .hero-column-content {
    position: absolute;
    bottom: 80px;
    z-index: 3;
    color: var(--hero-text);
    text-align: center;
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
    pointer-events: none;
    text-shadow: 0 2px 20px rgba(0, 0, 0, 0.9);
    padding: 0 25px;
    width: 100%;
  }

  .hero-column:hover .hero-column-content {
    opacity: 1;
    transform: translateY(0);
  }

  .hero-column-title {
    font-family: var(--hero-font-heading);
    font-weight: 700;
    font-size: clamp(1.8rem, 4vw, 3.5rem);
    margin: 0 0 12px 0;
    color: var(--hero-text);
  }

  .hero-column-subtitle {
    font-family: var(--hero-font-body);
    font-weight: 500;
    font-size: clamp(0.9rem, 1.5vw, 1.25rem);
    max-width: 90%;
    margin: 0 auto;
    color: rgba(255, 255, 255, 0.9);
  }

  /* Center Content */
  .hero-center-content {
    position: absolute;
    z-index: 4;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    pointer-events: none;
    transition: opacity 0.5s ease-in-out;
    width: 100%;
    padding: 0 20px;
  }

  .hero-center-logo {
    max-width: 180px;
    height: auto;
    margin-bottom: 25px;
    filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.5));
  }

  .hero-center-text {
    font-family: var(--hero-font-heading);
    font-weight: 700;
    font-size: 2.5rem;
    color: var(--hero-accent);
    margin-bottom: 20px;
    letter-spacing: 3px;
  }

  .hero-center-heading {
    font-family: var(--hero-font-heading);
    font-weight: 600;
    font-size: clamp(1.8rem, 4vw, 3.5rem);
    color: var(--hero-text);
    margin: 0;
    text-shadow: 2px 2px 20px rgba(0, 0, 0, 0.6);
  }

  .hero-split-wrapper:hover ~ .hero-center-content {
    opacity: 0;
  }

  /* Mobile Container */
  .hero-mobile-container {
    display: none;
    width: 100%;
    height: 100%;
    min-height: 100vh;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background-color: var(--hero-bg);
    padding: 20px;
    overflow-y: auto;
  }

  .hero-mobile-header {
    text-align: center;
    margin-bottom: 25px;
    padding-top: 15px;
    position: relative;
    z-index: 1;
  }

  .hero-mobile-welcome {
    font-family: var(--hero-font-body);
    font-weight: 600;
    font-size: 0.85rem;
    color: var(--hero-accent);
    text-transform: uppercase;
    letter-spacing: 3px;
    margin: 0 0 8px 0;
  }

  .hero-mobile-title {
    font-family: var(--hero-font-heading);
    font-weight: 700;
    font-size: clamp(1.8rem, 7vw, 2.5rem);
    color: var(--hero-text);
    margin: 0;
  }

  .hero-cards-container {
    display: flex;
    flex-direction: column;
    gap: 18px;
    width: 100%;
    max-width: 420px;
    padding-bottom: 20px;
  }

  .hero-card-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 10;
  }

  .hero-card {
    position: relative;
    width: 100%;
    height: var(--hero-card-collapsed);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    cursor: pointer;
    transition: height 0.5s cubic-bezier(0.25, 1, 0.5, 1), transform 0.4s cubic-bezier(0.25, 1, 0.5, 1), box-shadow 0.4s ease-in-out;
    border: none !important;
    outline: none !important;
    background: none;
    padding: 0;
    will-change: transform, height, box-shadow;
  }

  .hero-card-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.55) saturate(0.8);
    transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
  }

  .hero-card::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60%;
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.95) 100%);
    z-index: 1;
    opacity: 0;
    transition: opacity 0.5s;
  }

  .hero-card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 2;
    width: 100%;
    text-align: center;
    color: var(--hero-text);
    padding: 30px 25px 25px;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
  }

  .hero-card-title {
    font-family: var(--hero-font-heading);
    font-weight: 700;
    font-size: 1.5rem;
    color: var(--hero-text);
    margin: 0 0 8px 0;
    text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.9);
  }

  .hero-card-subtitle {
    font-family: var(--hero-font-body);
    font-size: 0.95rem;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.9);
    margin: 0 0 15px 0;
    text-shadow: 1px 1px 8px rgba(0, 0, 0, 0.9);
  }

  .hero-card-btn {
    display: inline-block;
    background-color: var(--hero-accent);
    color: var(--hero-text);
    font-family: var(--hero-font-heading);
    font-weight: 600;
    font-size: 0.9rem;
    padding: 12px 28px;
    border-radius: 50px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-decoration: none;
    box-shadow: 0 4px 15px color-mix(in srgb, var(--hero-accent) 40%, transparent);
    transition: all 0.3s ease-in-out;
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px);
  }

  .hero-card-wrapper.is-active .hero-card-btn {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .hero-card-wrapper.is-active .hero-card-btn:hover {
    filter: brightness(1.15);
    transform: translateY(-2px);
  }

  /* Notification Dot */
  .hero-notification-dot {
    position: absolute;
    left: 50%;
    bottom: 25px;
    transform: translateX(-50%);
    width: 14px;
    height: 14px;
    background-color: var(--hero-dot);
    border-radius: 50%;
    z-index: 5;
    pointer-events: none;
    animation: hero-pulse 2s infinite;
    opacity: 1;
    transition: opacity 0.3s ease-in-out;
  }

  .hero-card-wrapper.is-active .hero-notification-dot {
    opacity: 0;
  }

  @keyframes hero-pulse {
    0% {
      transform: translateX(-50%) scale(0.95);
      box-shadow: 0 0 0 0 color-mix(in srgb, var(--hero-dot) 70%, transparent);
    }
    70% {
      transform: translateX(-50%) scale(1);
      box-shadow: 0 0 0 12px transparent;
    }
    100% {
      transform: translateX(-50%) scale(0.95);
      box-shadow: 0 0 0 0 transparent;
    }
  }

  /* Active Card State */
  .hero-card-wrapper.is-active .hero-card {
    height: var(--hero-card-expanded);
    box-shadow: 0 0 25px color-mix(in srgb, var(--hero-accent) 50%, transparent) !important;
    transform: translateY(-5px);
  }

  .hero-card-wrapper.is-active .hero-card-img {
    filter: brightness(1) saturate(1);
    transform: scale(1.05);
  }

  .hero-card-wrapper.is-active .hero-card::after {
    opacity: 1;
  }

  .hero-card-wrapper.is-active .hero-card-content {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .hero-split-section {
      height: auto;
      min-height: 100vh;
      display: block;
    }
    .hero-desktop-container {
      display: none;
    }
    .hero-mobile-container {
      display: flex;
    }
  }
{% endstyle %}

<section class="hero-split-section" aria-label="Hero: {{ section.settings.center_heading }}">
  <h1 class="hero-sr-only">{{ section.settings.seo_heading }}</h1>

  <!-- Desktop View -->
  <div class="hero-desktop-container">
    <div class="hero-split-wrapper cols-{{ section.settings.column_count }}">
      {% for block in section.blocks %}
        <article class="hero-column" {{ block.shopify_attributes }}>
          {% if block.settings.desktop_image %}
            {{ block.settings.desktop_image | image_url: width: 1600 | image_tag:
               class: 'hero-column-img',
               alt: block.settings.alt_text,
               loading: 'eager',
               fetchpriority: 'high'
            }}
          {% else %}
            {{ 'lifestyle-1' | placeholder_svg_tag: 'hero-column-img' }}
          {% endif %}
          
          <a href="{{ block.settings.link | default: '#' }}" class="hero-column-link" aria-label="{{ block.settings.title }}">
            <span class="hero-sr-only">Explore {{ block.settings.title }}</span>
          </a>
          
          <div class="hero-column-content" aria-hidden="true">
            <h2 class="hero-column-title">{{ block.settings.title }}</h2>
            <p class="hero-column-subtitle">{{ block.settings.subtitle }}</p>
          </div>
        </article>
      {% endfor %}
    </div>

    <div class="hero-center-content" aria-hidden="true">
      {% if section.settings.center_logo %}
        {{ section.settings.center_logo | image_url: width: 400 | image_tag:
           class: 'hero-center-logo',
           alt: shop.name
        }}
      {% else %}
        <div class="hero-center-text">{{ section.settings.center_brand_text }}</div>
      {% endif %}
      <h2 class="hero-center-heading">{{ section.settings.center_heading }}</h2>
    </div>
  </div>

  <!-- Mobile View -->
  <div class="hero-mobile-container">
    <header class="hero-mobile-header">
      <p class="hero-mobile-welcome">{{ section.settings.mobile_welcome }}</p>
      <h2 class="hero-mobile-title">{{ section.settings.mobile_heading }}</h2>
    </header>

    <div class="hero-cards-container">
      {% for block in section.blocks %}
        <article class="hero-card-wrapper" {{ block.shopify_attributes }}>
          <div class="hero-card" role="button" tabindex="0" aria-expanded="false">
            {% if block.settings.mobile_image %}
              {{ block.settings.mobile_image | image_url: width: 800 | image_tag:
                 class: 'hero-card-img',
                 alt: block.settings.alt_text,
                 loading: 'lazy'
              }}
            {% elsif block.settings.desktop_image %}
              {{ block.settings.desktop_image | image_url: width: 800 | image_tag:
                 class: 'hero-card-img',
                 alt: block.settings.alt_text,
                 loading: 'lazy'
              }}
            {% else %}
              {{ 'collection-1' | placeholder_svg_tag: 'hero-card-img' }}
            {% endif %}
            
            <div class="hero-notification-dot"></div>

            <div class="hero-card-content">
              <h3 class="hero-card-title">{{ block.settings.title }}</h3>
              <p class="hero-card-subtitle">{{ block.settings.subtitle }}</p>
              <a href="{{ block.settings.link | default: '#' }}" class="hero-card-btn">{{ block.settings.button_text }}</a>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  </div>
</section>

<script>
(function() {
  'use strict';

  function initSplitHero() {
    const section = document.querySelector('#shopify-section-{{ section.id }}');
    if (!section) return;

    const wrappers = section.querySelectorAll('.hero-card-wrapper');
    const mobileContainer = section.querySelector('.hero-mobile-container');

    if (!mobileContainer || wrappers.length === 0) return;

    function activateCard(targetWrapper) {
      const card = targetWrapper.querySelector('.hero-card');
      if (!card) return;

      const isAlreadyActive = targetWrapper.classList.contains('is-active');

      wrappers.forEach(w => {
        w.classList.remove('is-active');
        const c = w.querySelector('.hero-card');
        if (c) c.setAttribute('aria-expanded', 'false');
      });

      if (!isAlreadyActive) {
        targetWrapper.classList.add('is-active');
        card.setAttribute('aria-expanded', 'true');

        if (window.innerWidth <= 768) {
          setTimeout(() => {
            try {
              targetWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } catch(e) {}
          }, 150);
        }
      }
    }

    function closeAllCards() {
      wrappers.forEach(w => {
        w.classList.remove('is-active');
        const c = w.querySelector('.hero-card');
        if (c) c.setAttribute('aria-expanded', 'false');
      });
    }

    function handleClick(e) {
      if (e.target.closest('.hero-card-btn')) {
        e.stopPropagation();
        return;
      }

      const clickedCard = e.target.closest('.hero-card');

      if (clickedCard) {
        const wrapper = clickedCard.closest('.hero-card-wrapper');
        if (!wrapper) return;
        e.preventDefault();
        activateCard(wrapper);
      } else if (!e.target.closest('.hero-card-wrapper')) {
        closeAllCards();
      }
    }

    function handleKeydown(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        const card = e.target.closest('.hero-card');
        if (card) {
          e.preventDefault();
          const wrapper = card.closest('.hero-card-wrapper');
          if (wrapper) activateCard(wrapper);
        }
      }
      if (e.key === 'Escape') {
        closeAllCards();
      }
    }

    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const rect = mobileContainer.getBoundingClientRect();
        if (rect.bottom < 0 || rect.top > window.innerHeight) {
          closeAllCards();
        }
      }, 150);
    }, { passive: true });

    mobileContainer.addEventListener('click', handleClick);
    mobileContainer.addEventListener('keydown', handleKeydown);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSplitHero);
  } else {
    initSplitHero();
  }

  document.addEventListener('shopify:section:load', function(e) {
    if (e.target.querySelector('.hero-split-section')) {
      initSplitHero();
    }
  });
})();
</script>
